
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#101820">
    <title>JugendInvestiert</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="/icon.png">
    <link rel="icon" type="image/x-icon" href="/favicon.png">
    <style>
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: auto;
        }
        body {
            font-family: 'Poppins', Arial, sans-serif;
            display: flex;
            background-color: #101820;
            color: white;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
        body::-webkit-scrollbar { display: none; }
        body.modal-open {
            overflow: hidden;
        }
        .bottom-nav { display: none; }
        .sidebar {
            width: 320px;
            background-color: #1B2631;
            height: 100vh;
            padding: 0 10px;
            position: fixed;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.3s ease;
        }
        .sidebar h2 {
            text-align: center;
            font-size: 26px;
            color: white;
            margin-bottom: 20px;
            padding: 0 10px;
        }
        .sidebar a {
            display: flex;
            align-items: center;
            color: white;
            padding: 12px 16px;
            text-decoration: none;
            font-size: 16px;
            border: 2px solid transparent;
            border-radius: 15px;
            margin: 10px 0;
            transition: transform 0.3s ease, background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            text-transform: uppercase;
            width: 85%;
            justify-content: flex-start;
        }
        .sidebar a:hover { background-color: #34495e; }
        .sidebar a.active {
            background-color: transparent;
            border: 3px solid #4ab3ff;
            box-shadow: 0 0 5px rgba(74, 179, 255, 0.5);
            border-radius: 15px;
        }
        .sidebar a .emoji { margin-right: 12px; }
        .emoji-image { width: 36px; height: 36px; margin-right: 12px; object-fit: fill; }
        .emoji-image-large { width: 42px; height: 42px; object-fit: contain; }
        .sidebar a.login, .sidebar a.signup, .sidebar a.logout, .sidebar a.cube {
            justify-content: center;
            text-align: center;
            padding: 12px 0;
            font-size: 18px;
            width: 85%;
            margin-top: 12px;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        .sidebar a.login { background-color: #007ce2; margin-bottom: 0px; }
        .sidebar a.signup { background-color: #7F8C8D; }
        .sidebar a.logout { display: none; background-color: #E74C3C; }
        .sidebar a.cube {
            background-color: #2A3F5F;
            border: none;
            box-shadow: 0 ÌïôÍµê 5px rgba(74, 179, 255, 0.5);
            height: calc(85% * 0.5625);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            font-weight: bold;
            line-height: 1.3;
        }
        .sidebar a.cube span { display: block; }
        .sidebar a.cube #counter {
            font-weight: bold;
            font-size: 64px;
            color: #007ce2;
            padding: 0 4px;
            display: inline-flex;
            align-items: center;
        }
        .sidebar a.cube #counter::after {
            content: '';
            font-size: 28px;
            color: #007ce2;
            margin-left: 4px;
        }
        .sidebar a.cube #counter.completed::after {
            content: '+';
        }
        .sidebar a.login:hover, .sidebar a.signup:hover, .sidebar a.logout:hover, .sidebar a.cube:hover { transform: scale(1.05); }
        .bottom-buttons {
            margin-top: auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 20px;
        }
        .content {
            margin-left: 320px;
            width: calc(100% - 320px);
            color: white;
            height: 100vh;
            overflow-y: auto;
        }
        .content h1 { font-size: 32px; }
        .content section { display: none; width: 100%; height: 100vh; }
        .content section.active { display: flex; flex-direction: column; justify-content: center; }
        .content iframe { width: 100%; height: 100%; border: none; }
        .profile-section {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        .profile-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-bottom: 20px;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid #4ab3ff;
        }
        .profile-image:hover {
            opacity: 0.8;
        }
        .profile-form {
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .profile-form label {
            color: #fff;
            font-weight: 500;
            font-size: 14px;
        }
        .profile-form input {
            width: 100%;
            padding: 10px 12px;
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            box-sizing: border-box;
            transition: background-color 0.3s;
        }
        .profile-form input:focus {
            background-color: rgba(255, 255, 255, 0.3);
            outline: none;
        }
        .profile-form button {
            width: 100%;
            padding: 12px;
            margin-top: 16px;
            background: #007ce2;
            border: none;
            border-radius: 25px;
            color: #fff;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .profile-form button:hover {
            background: #005bb5;
            transform: translateY(-2px);
        }
        .profile-form button.logout {
            background: #E74C3C;
            display: none;
        }
        .profile-form button.logout:hover {
            background: #c0392b;
        }
        .profile-indicators {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .profile-indicators span {
            color: #a2e5ff;
            font-size: 14px;
            font-weight: 500;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 24px;
            width: 90%;
            max-width: 400px;
            position: relative;
            color: white;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            animation: slideUp 0.3s ease-out;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .modal-content::-webkit-scrollbar { display: none; }
        .modal-content form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .disclaimer-text {
            flex-grow: 1;
            overflow-y: auto;
            padding-bottom: 10px;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .disclaimer-text::-webkit-scrollbar { display: none; }
        .disclaimer-copyright {
            font-size: 12px;
            color: #cccccc;
            text-align: center;
            margin-top: 20px;
        }
        .disclaimer-button-container {
            padding-top: 10px;
        }
        .close {
            color: #fff;
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }
        .close:hover, .close:focus { color: #a2e5ff; }
        .modal-content h2 {
            margin-top: 0;
            text-align: center;
            color: #a2e5ff;
            margin-bottom: 25px;
            font-weight: 600;
        }
        .modal-content label {
            margin-top: 12px;
            color: #fff;
            font-weight: 500;
            font-size: 14px;
        }
        .modal-content input, .modal-content select {
            width: 100%;
            padding: 10px 12px;
            margin-top: 6px;
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            box-sizing: border-box;
            transition: background-color 0.3s;
        }
        .modal-content input:focus, .modal-content select:focus {
            background-color: rgba(255, 255, 255, 0.3);
            outline: none;
        }
        .modal-content button {
            width: 100%;
            padding: 12px;
            margin-top: 16px;
            background: linear-gradient(45deg, #6A82FB, #FC5C7D);
            border: none;
            border-radius: 25px;
            color: #fff;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .modal-content button:hover {
            background: linear-gradient(45deg, #5a73d1, #e04c5c);
            transform: translateY(-2px);
        }
        .modal-content .switch-link {
            text-align: center;
            margin-top: 15px;
            color: #a2e5ff;
            font-size: 14px;
        }
        .modal-content .switch-link a {
            color: #a2e5ff;
            text-decoration: underline;
            cursor: pointer;
            transition: color 0.3s;
        }
        .modal-content .switch-link a:hover { color: #ffffff; }
        .language-selector {
            width: 100%;
            padding: 10px 12px;
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .language-selector:focus {
            background-color: rgba(255, 255, 255, 0.3);
            outline: none;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        #loader {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 1.5rem;
        }
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            z-index: 3000;
            opacity: 0.95;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            animation: fadeInOut 4s forwards;
        }
        .message.error { background-color: #f44336; }
        .message i { font-size: 1.5rem; }
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
        @media (max-width: 768px) {
            body { flex-direction: column; }
            .sidebar { display: none; }
            .content {
                margin-left: 0;
                width: 100%;
                padding: 0;
                height: calc(100vh - 60px);
                overflow-y: auto;
            }
            .content section.active {
                border: none;
                box-shadow: none;
            }
            .content iframe { height: 100%; }
            .bottom-nav {
                display: flex;
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                background-color: #1B2631;
                justify-content: space-evenly;
                padding: 15px 0;
                box-shadow: 0 -2px 5px rgba(0,0,0,0.3);
                padding-bottom: calc(15px + env(safe-area-inset-bottom));
                transition: transform 0.3s ease;
                z-index: 100;
            }
            .bottom-nav a {
                color: white;
                text-decoration: none;
                font-size: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: color 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
                border-radius: 10px;
                padding: 6px;
                width: 14%;
            }
            .bottom-nav a.active {
                background-color: transparent;
                border: none;
                box-shadow: none;
            }
            .bottom-nav a .emoji-image { margin-right: 0; width: 36px; height: 36px; object-fit: contain; }
            .modal-content {
                width: 85%;
                max-width: 340px;
                padding: 20px;
                margin: 0 16px;
            }
            .modal-content input, .modal-content select {
                font-size: 13px;
                padding: 8px 10px;
            }
            .modal-content label {
                font-size: 13px;
            }
            .modal-content button {
                padding: 10px;
                font-size: 14px;
            }
            .modal-content h2 {
                font-size: 20px;
                margin-bottom: 20px;
            }
            .profile-section {
                padding: 15px;
            }
            .profile-image {
                width: 80px;
                height: 80px;
            }
            .profile-form {
                max-width: 300px;
            }
            .profile-form input {
                font-size: 13px;
                padding: 8px 10px;
            }
            .profile-form label {
                font-size: 13px;
            }
            .profile-form button {
                padding: 10px;
                font-size: 14px;
            }
            .profile-indicators {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            .sidebar .bottom-buttons {
                display: none;
            }
        }
        .password-check-row { display: flex; align-items: center; margin-top: 8px; gap: 8px; }
        /* New CSS for Change Password and Disable Account buttons */
        .profile-form button.change-password {
            background: #f39c12;
        }
        .profile-form button.change-password:hover {
            background: #e67e22;
        }
        .profile-form button.disable-account {
            background: #c0392b;
        }
        .profile-form button.disable-account:hover {
            background: #992d22;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2 data-translate-key="brand">JugendInvestiert</h2>
        <a href="#home" class="button active" onclick="showSection('home', this)">
            <img src="house2.png" alt="Home" class="emoji-image"> <span data-translate-key="home">Home</span>
        </a>
        <a href="#lernen" class="button" onclick="showSection('lernen', this)">
            <img src="lernen.jpg" alt="Lernen" class="emoji-image emoji-image-large"> <span data-translate-key="learn">Lernen</span>
        </a>
        <a href="#resourcen" class="button" onclick="showSection('resourcen', this)">
            <img src="ressourcen.png" alt="Ressourcen" class="emoji-image"> <span data-translate-key="resources">Ressourcen</span>
        </a>
        <a href="#simulator" class="button" onclick="showSection('simulator', this)">
            <img src="simulator.png" alt="Simulator" class="emoji-image emoji-image-large"> <span data-translate-key="simulator">Simulator</span>
        </a>
        <a href="#unsere-mission" class="button" onclick="showSection('unsere-mission', this)">
            <img src="mission.png" alt="Unsere Mission" class="emoji-image emoji-image-large"> <span data-translate-key="mission">Unsere Mission</span>
        </a>
        <a href="#profil" class="button" onclick="showSection('profil', this)">
            <img src="profile.png" alt="Profil" class="emoji-image"> <span data-translate-key="profile">Profil</span>
        </a>
        <a href="#signup" class="cube" onclick="openModal('signupModal')">
            <span data-translate-key="joinNow">Tritt jetz</span>
            <span><span id="counter">0</span></span>
            <span data-translate-key="studentsAt">sch√ºlern bei!</span>
        </a>
        <div class="bottom-buttons">
            <a href="#login" class="button login" onclick="openModal('loginModal')">
                <img src="login.png" alt="Anmelden" class="emoji-image"> <span data-translate-key="login">Anmelden</span>
            </a>
            <a href="#signup" class="button signup" onclick="openModal('signupModal')">
                <img src="register.png" alt="Registrieren" class="emoji-image"> <span data-translate-key="signup">Registrieren</span>
            </a>
            <a href="#logout" class="button logout" onclick="logout()">
                <img src="abmelden.jpg" alt="Abmelden" class="emoji-image"> <span data-translate-key="logout">Abmelden</span>
            </a>
        </div>
    </div>
    <div class="content">
        <section id="home" class="active">
            <iframe src="home.html" id="home-iframe"></iframe>
        </section>
        <section id="lernen">
            <iframe src="lessons.html" id="lernen-iframe"></iframe>
        </section>
        <section id="resourcen">
            <iframe src="ressources.html" id="resourcen-iframe"></iframe>
        </section>
        <section id="simulator">
            <iframe src="simulator.html" id="simulator-iframe"></iframe>
        </section>
        <section id="unsere-mission">
            <iframe src="ourmission.html" id="mission-iframe"></iframe>
        </section>
        <section id="profil">
            <div class="profile-section">
                <img src="profile.png" alt="Profile" class="profile-image" id="profile-image" onclick="document.getElementById('profile-image-upload').click()">
                <input type="file" id="profile-image-upload" accept="image/*" style="display: none;" onchange="uploadProfileImage()">
                <div class="profile-indicators">
                    <span data-translate-key="level">Level: Coming Soon</span>
                    <span data-translate-key="streak">Streak: Coming Soon</span>
                </div>
                <form class="profile-form">
                    <label for="profile-email" data-translate-key="email">Email:</label>
                    <input type="email" id="profile-email" readonly>
                    <label for="profile-alias" data-translate-key="alias">Alias:</label>
                    <input type="text" id="profile-alias" placeholder="Dein Alias">
                    <button type="button" onclick="saveProfile()" data-translate-key="save">Speichern</button>
                    <button type="button" class="change-password" onclick="openModal('changePasswordModal')" data-translate-key="changePassword">Passwort √§ndern</button>
                    <button type="button" class="disable-account" onclick="openModal('disableAccountModal')" data-translate-key="disableAccount">Konto deaktivieren</button>
                    <button type="button" class="logout" onclick="logout()" data-translate-key="logout">Abmelden</button>
                </form>
            </div>
        </section>
    </div>
    <div class="bottom-nav">
        <a href="#home" class="button active" onclick="showSection('home', this)">
            <img src="house2.png" alt="Home" class="emoji-image">
        </a>
        <a href="#lernen" class="button" onclick="showSection('lernen', this)">
            <img src="lernen.jpg" alt="Lernen" class="emoji-image">
        </a>
        <a href="#resourcen" class="button" onclick="showSection('resourcen', this)">
            <img src="ressourcen.png" alt="Ressourcen" class="emoji-image">
        </a>
        <a href="#simulator" class="button" onclick="showSection('simulator', this)">
            <img src="simulator.png" alt="Simulator" class="emoji-image">
        </a>
        <a href="#unsere-mission" class="button" onclick="showSection('unsere-mission', this)">
            <img src="mission.png" alt="Unsere Mission" class="emoji-image">
        </a>
        <a href="#profil" class="button" onclick="showSection('profil', this)">
            <img src="profile.png" alt="Profil" class="emoji-image">
        </a>
    </div>
    <div id="loginModal" class="modal">
        <div class="modal-content" id="loginModalContent">
            <span class="close" onclick="closeModal('loginModal')">√ó</span>
            <h2 id="loginModalTitle" data-translate-key="login">Anmelden</h2>
            <div id="loginForm" style="display: block;">
                <form>
                    <label for="login-email" data-translate-key="email">Email:</label>
                    <input type="email" id="login-email" placeholder="Deine Email" required>
                    <label for="login-password" data-translate-key="password">Passwort:</label>
                    <input type="password" id="login-password" placeholder="Dein Passwort" required>
                    <button type="button" onclick="login()" data-translate-key="login">Anmelden</button>
                </form>
                <p class="switch-link">
                    <a href="#" onclick="openModal('resetModal')" data-translate-key="forgotPassword">Passwort vergessen?</a>
                </p>
                <p class="switch-link" data-translate-key="notRegistered">
                    Noch nicht angemeldet? <a href="#" onclick="switchToSignup()">Jetzt Registrieren</a>
                </p>
            </div>
            <div id="logoutForm" style="display: none;">
                <p data-translate-key="loggedIn">Du bist angemeldet.</p>
                <button type="button" onclick="logout()" style="background: #E74C3C;" data-translate-key="logout">Abmelden</button>
            </div>
        </div>
    </div>
    <div id="signupModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('signupModal')">√ó</span>
            <h2 data-translate-key="signup">Registrieren</h2>
            <form>
                <label for="signup-email" data-translate-key="email">Email:</label>
                <input type="email" id="signup-email" placeholder="Deine Email" required>
                <label for="signup-password" data-translate-key="password">Passwort:</label>
                <input type="password" id="signup-password" placeholder="Dein Passwort" required>
                <label for="signup-password-confirm" data-translate-key="confirmPassword">Passwort best√§tigen:</label>
                <input type="password" id="signup-password-confirm" placeholder="Passwort best√§tigen" required>
                <div class="password-check-row">
                    <i class="fas fa-times" id="password-check-length" style="color: red;"></i>
                    <span data-translate-key="passwordLength">Mehr als 6 Zeichen</span>
                </div>
                <div class="password-check-row">
                    <i class="fas fa-times" id="password-check-letter" style="color: red;"></i>
                    <span data-translate-key="passwordLetter">Mindestens ein Buchstabe</span>
                </div>
                <div class="password-check-row">
                    <i class="fas fa-times" id="password-check-number" style="color: red;"></i>
                    <span data-translate-key="passwordNumber">Mindestens eine Zahl</span>
                </div>
                <div class="password-check-row">
                    <i class="fas fa-times" id="password-check-match" style="color: red;"></i>
                    <span data-translate-key="passwordMatch">Passw√∂rter stimmen √ºberein</span>
                </div>
                <button type="button" onclick="signup()" data-translate-key="signup">Registrieren</button>
            </form>
            <p class="switch-link" data-translate-key="alreadyRegistered">
                Bereits registriert? <a href="#" onclick="switchToLogin()">Zur√ºck zum Anmelden</a>
            </p>
        </div>
    </div>
    <div id="resetModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('resetModal')">√ó</span>
            <h2 data-translate-key="resetPassword">Passwort zur√ºcksetzen</h2>
            <form>
                <label for="reset-email" data-translate-key="email">Email:</label>
                <input type="email" id="reset-email" placeholder="Deine Email" required>
                <button type="button" onclick="resetPassword()" data-translate-key="resetPassword">Passwort zur√ºcksetzen</button>
            </form>
        </div>
    </div>
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('changePasswordModal')">√ó</span>
            <h2 data-translate-key="changePassword">Passwort √§ndern</h2>
            <form>
                <label for="current-password" data-translate-key="currentPassword">Aktuelles Passwort:</label>
                <input type="password" id="current-password" placeholder="Aktuelles Passwort" required>
                <label for="new-password" data-translate-key="newPassword">Neues Passwort:</label>
                <input type="password" id="new-password" placeholder="Neues Passwort" required>
                <label for="new-password-confirm" data-translate-key="confirmPassword">Neues Passwort best√§tigen:</label>
                <input type="password" id="new-password-confirm" placeholder="Neues Passwort best√§tigen" required>
                <div class="password-check-row">
                    <i class="fas fa-times" id="new-password-check-length" style="color: red;"></i>
                    <span data-translate-key="passwordLength">Mehr als 6 Zeichen</span>
                </div>
                <div class="password-check-row">
                    <i class="fas fa-times" id="new-password-check-letter" style="color: red;"></i>
                    <span data-translate-key="passwordLetter">Mindestens ein Buchstabe</span>
                </div>
                <div class="password-check-row">
                    <i class="fas fa-times" id="new-password-check-number" style="color: red;"></i>
                    <span data-translate-key="passwordNumber">Mindestens eine Zahl</span>
                </div>
                <div class="password-check-row">
                    <i class="fas fa-times" id="new-password-check-match" style="color: red;"></i>
                    <span data-translate-key="passwordMatch">Passw√∂rter stimmen √ºberein</span>
                </div>
                <button type="button" onclick="changePassword()" data-translate-key="changePassword">Passwort √§ndern</button>
            </form>
        </div>
    </div>
    <div id="disableAccountModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('disableAccountModal')">√ó</span>
            <h2 data-translate-key="disableAccount">Konto deaktivieren</h2>
            <form>
                <p data-translate-key="disableAccountWarning">Achtung: Diese Aktion kann nicht r√ºckg√§ngig gemacht werden. Dein Konto wird dauerhaft deaktiviert.</p>
                <label for="disable-password" data-translate-key="password">Passwort:</label>
                <input type="password" id="disable-password" placeholder="Dein Passwort" required>
                <button type="button" onclick="disableAccount()" data-translate-key="disableAccount">Konto deaktivieren</button>
            </form>
        </div>
    </div>
    <div id="disclaimerModal" class="modal">
        <div class="modal-content">
            <select id="languageSelector" class="language-selector" onchange="changeLanguage(this.value)">
                <option value="de" selected>Deutsch</option>
                <option value="en">English</option>
                <option value="fr">Fran√ßais</option>
            </select>
            <h2 data-translate-key="disclaimerTitle">Haftungsausschluss</h2>
            <div class="disclaimer-text">
                <p data-translate-key="disclaimerP1">
                    Die Inhalte dieser Website, einschlie√ülich Texte, Grafiken und Simulationen, dienen ausschlie√ülich zu allgemeinen Informations- und Bildungszwecken und stellen ausdr√ºcklich <strong>keine Finanz- oder Anlageberatung</strong> im Sinne des deutschen Rechts dar. Der Betreiber dieser Website √ºbernimmt keine Haftung f√ºr finanzielle oder sonstige Entscheidungen, die auf Grundlage der bereitgestellten Informationen getroffen werden. Es werden keine individuellen Empfehlungen abgegeben.
                </p>
                <p data-translate-key="disclaimerP2">
                    Alle Informationen wurden nach bestem Wissen und Gewissen erstellt. Dennoch wird keine Gew√§hr f√ºr die Aktualit√§t, Richtigkeit, Vollst√§ndigkeit oder Qualit√§t der bereitgestellten Inhalte √ºbernommen. Investitionen in Finanzinstrumente sind mit erheblichen Risiken verbunden, einschlie√ülich des m√∂glichen Totalverlusts des eingesetzten Kapitals. Nutzer werden aufgefordert, sich vor jeder Investitionsentscheidung unabh√§ngig und umfassend zu informieren und gegebenenfalls eine <strong>qualifizierte, individuelle Finanzberatung</strong> in Anspruch zu nehmen.
                </p>
                <p data-translate-key="disclaimerP3">
                    Durch das Klicken auf ‚ÄûAkzeptieren‚Äú erkl√§ren Sie sich rechtsverbindlich damit einverstanden, dass Sie die alleinige Verantwortung f√ºr Ihre Handlungen und Entscheidungen tragen und den Betreiber dieser Website von jeglicher Haftung freistellen. Sie best√§tigen, dass Sie den Haftungsausschluss sowie unsere <a href="https://www.privacypolicies.com/live/7b3f0632-4bb2-4278-ad12-d1a646c51c79" target="_blank" style="color: #a2e5ff; text-decoration: underline;" data-translate-key="privacyPolicy">Datenschutzerkl√§rung</a> gelesen und verstanden haben. Sind Sie mit diesen Bedingungen nicht einverstanden, bitten wir Sie, die Nutzung dieser Website unverz√ºglich einzustellen.
                </p>
                <p class="disclaimer-copyright" data-translate-key="copyright">
                    ¬© 2025 JugendInvestiert. Alle Rechte vorbehalten.
                </p>
            </div>
            <div class="disclaimer-button-container">
                <button type="button" onclick="acceptDisclaimer()" data-translate-key="accept">Akzeptieren</button>
            </div>
        </div>
    </div>
    <div id="loader"><i class="fas fa-spinner fa-spin"></i></div>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>
    <script>
        const jsConfetti = new JSConfetti();
        function triggerConfetti() {
            jsConfetti.addConfetti({
                confettiRadius: 6,
                confettiNumber: 500,
                confettiColors: ['#ff0a54', '#ff477e', '#ff7096', '#ff85a1', '#ff99ac', '#fbb1bd'],
                emojis: ['üíµ'],
                emojiSize: 80,
            });
        }
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => console.log('ServiceWorker registration successful:', registration.scope))
                    .catch(error => console.log('ServiceWorker registration failed:', error));
            });
        }
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('A2HS prompt is available');
        });
        window.addEventListener('appinstalled', () => {
            console.log('PWA was installed');
        });
        let lastScrollTop = 0;
        function handleScroll() {
            const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const isMobile = window.innerWidth <= 768;
            const sidebar = document.querySelector('.sidebar');
            const bottomNav = document.querySelector('.bottom-nav');
            if (currentScrollTop > lastScrollTop && currentScrollTop > 50) {
                if (isMobile) {
                    bottomNav.style.transform = 'translateY(100%)';
                } else {
                    sidebar.style.transform = 'translateX(-100%)';
                }
            } else {
                if (isMobile) {
                    bottomNav.style.transform = 'translateY(0)';
                } else {
                    sidebar.style.transform = 'translateX(0)';
                }
            }
            lastScrollTop = currentScrollTop <= 0 ? 0 : currentScrollTop;
        }
        window.addEventListener('scroll', handleScroll);
        function requestFullscreen() {
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen().catch(err => console.log('Fullscreen failed:', err));
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            }
        }
        function startCounter() {
            const counterElement = document.getElementById('counter');
            let count = 0;
            const target = 15000;
            const duration = 4000; // 4 seconds
            const increment = target / (duration / 16); // ~60fps
            function updateCounter() {
                count += increment;
                if (count >= target) {
                    counterElement.textContent = '15000';
                    counterElement.classList.add('completed');
                    return;
                }
                counterElement.textContent = Math.floor(count).toString();
                requestAnimationFrame(updateCounter);
            }
            counterElement.textContent = '0';
            requestAnimationFrame(updateCounter);
        }
        document.addEventListener('DOMContentLoaded', () => {
            handleScroll();
            const cubeLink = document.querySelector('.sidebar a.cube');
            cubeLink.addEventListener('click', (e) => {
                e.preventDefault();
                openModal('signupModal');
            });
            const disclaimerModal = document.getElementById('disclaimerModal');
            if (disclaimerModal) {
                disclaimerModal.style.display = 'flex';
                document.body.classList.add('modal-open');
            }
            const storedLang = localStorage.getItem('preferredLanguage');
            if (storedLang && translations[storedLang]) {
                changeLanguage(storedLang);
            } else {
                applyTranslations('de');
            }
            const signupPassword = document.getElementById('signup-password');
            const signupPasswordCheck = document.getElementById('signup-password-confirm');
            const newPassword = document.getElementById('new-password');
            const newPasswordCheck = document.getElementById('new-password-confirm');
            if (signupPassword && signupPasswordCheck) {
                signupPassword.addEventListener('input', validatePassword);
                signupPasswordCheck.addEventListener('input', validatePassword);
            }
            if (newPassword && newPasswordCheck) {
                newPassword.addEventListener('input', validateNewPassword);
                newPasswordCheck.addEventListener('input', validateNewPassword);
            }
            // Ensure language is sent to iframes on load
            setTimeout(() => {
                changeLanguage(storedLang || 'de');
            }, 100);
            // Add load event listeners for iframes
            const iframes = [
                { id: 'home-iframe', src: 'home.html' },
                { id: 'lernen-iframe', src: 'lessons.html' },
                { id: 'resourcen-iframe', src: 'ressources.html' },
                { id: 'simulator-iframe', src: 'simulator.html' },
                { id: 'mission-iframe', src: 'ourmission.html' }
            ];
            iframes.forEach(iframe => {
                const iframeElement = document.getElementById(iframe.id);
                if (iframeElement) {
                    iframeElement.addEventListener('load', () => {
                        sendLanguageMessage();
                    });
                }
            });
        });
        const firebaseConfig = {
            apiKey: "AIzaSyDmEUCl7sWzBI7N78HgcgBRcRAkTYbtm5g",
            authDomain: "jugendinvestiert-5f6eb.firebaseapp.com",
            databaseURL: "https://jugendinvestiert-5f6eb-default-rtdb.firebaseio.com",
            projectId: "jugendinvestiert-5f6eb",
            storageBucket: "jugendinvestiert-5f6eb.appspot.com",
            messagingSenderId: "432595310987",
            appId: "1:432595310987:web:fd9f7975d5e87f1fe1378e",
            measurementId: "G-5ENQC9KQBY"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();
        const translations = {
            "de": {
                "brand": "JugendInvestiert",
                "home": "Home",
                "learn": "Lernen",
                "resources": "Ressourcen",
                "simulator": "Simulator",
                "mission": "Unsere Mission",
                "profile": "Profil",
                "login": "Anmelden",
                "signup": "Registrieren",
                "logout": "Abmelden",
                "email": "Email:",
                "password": "Passwort:",
                "currentPassword": "Aktuelles Passwort:",
                "newPassword": "Neues Passwort:",
                "confirmPassword": "Passwort best√§tigen:",
                "passwordLength": "Mehr als 6 Zeichen",
                "passwordLetter": "Mindestens ein Buchstabe",
                "passwordNumber": "Mindestens eine Zahl",
                "passwordMatch": "Passw√∂rter stimmen √ºberein",
                "forgotPassword": "Passwort vergessen?",
                "notRegistered": "Noch nicht angemeldet? <a href=\"#\" onclick=\"switchToSignup()\">Jetzt Registrieren</a>",
                "alreadyRegistered": "Bereits registriert? <a href=\"#\" onclick=\"switchToLogin()\">Zur√ºck zum Anmelden</a>",
                "resetPassword": "Passwort zur√ºcksetzen",
                "changePassword": "Passwort √§ndern",
                "disableAccount": "Konto deaktivieren",
                "disableAccountWarning": "Achtung: Diese Aktion kann nicht r√ºckg√§ngig gemacht werden. Dein Konto wird dauerhaft deaktiviert.",
                "loggedIn": "Du bist angemeldet.",
                "disclaimerTitle": "Haftungsausschluss",
                "disclaimerP1": "Die Inhalte dieser Website, einschlie√ülich Texte, Grafiken und Simulationen, dienen ausschlie√ülich zu allgemeinen Informations- und Bildungszwecken und stellen ausdr√ºcklich <strong>keine Finanz- oder Anlageberatung</strong> im Sinne des deutschen Rechts dar. Der Betreiber dieser Website √ºbernimmt keine Haftung f√ºr finanzielle oder sonstige Entscheidungen, die auf Grundlage der bereitgestellten Informationen getroffen werden. Es werden keine individuellen Empfehlungen abgegeben.",
                "disclaimerP2": "Alle Informationen wurden nach bestem Wissen und Gewissen erstellt. Dennoch wird keine Gew√§hr f√ºr die Aktualit√§t, Richtigkeit, Vollst√§ndigkeit oder Qualit√§t der bereitgestellten Inhalte √ºbernommen. Investitionen in Finanzinstrumente sind mit erheblichen Risiken verbunden, einschlie√ülich des m√∂glichen Totalverlusts des eingesetzten Kapitals. Nutzer werden aufgefordert, sich vor jeder Investitionsentscheidung unabh√§ngig und umfassend zu informieren und gegebenenfalls eine <strong>qualifizierte, individuelle Finanzberatung</strong> in Anspruch zu nehmen.",
                "disclaimerP3": "Durch das Klicken auf ‚ÄûAkzeptieren‚Äú erkl√§ren Sie sich rechtsverbindlich damit einverstanden, dass Sie die alleinige Verantwortung f√ºr Ihre Handlungen und Entscheidungen tragen und den Betreiber dieser Website von jeglicher Haftung freistellen. Sie best√§tigen, dass Sie den Haftungsausschluss sowie unsere <a href=\"https://www.privacypolicies.com/live/7b3f0632-4bb2-4278-ad12-d1a646c51c79\" target=\"_blank\" style=\"color: #a2e5ff; text-decoration: underline;\">Datenschutzerkl√§rung</a> gelesen und verstanden haben. Sind Sie mit diesen Bedingungen nicht einverstanden, bitten wir Sie, die Nutzung dieser Website unverz√ºglich einzustellen.",
                "copyright": "¬© 2025 JugendInvestiert. Alle Rechte vorbehalten.",
                "privacyPolicy": "Datenschutzerkl√§rung",
                "accept": "Akzeptieren",
                "alias": "Alias:",
                "age": "Alter:",
                "save": "Speichern",
                "profileSaved": "Profil erfolgreich gespeichert!",
                "level": "Level: Coming Soon",
                "streak": "Streak: Coming Soon",
                "imageUploadError": "Fehler beim Hochladen des Profilbildes.",
                "joinNow": "Tritt jetz",
                "studentsAt": "sch√ºlern bei!",
                "enterEmailPassword": "Bitte Email und Passwort eingeben.",
                "verifyEmail": "Bitte verifiziere zuerst deine E-Mail.",
                "enterAllFields": "Bitte alle Felder ausf√ºllen.",
                "passwordMismatch": "Die Passw√∂rter stimmen nicht √ºberein!",
                "passwordTooShort": "Das Passwort muss mehr als 6 Zeichen haben!",
                "passwordNoLetter": "Das Passwort braucht mindestens einen Buchstaben!",
                "passwordNoNumber": "Das Passwort braucht mindestens eine Zahl!",
                "emailVerificationError": "Fehler beim Senden der Verifizierungs-E-Mail: ",
                "enterEmail": "Bitte Email angeben.",
                "resetEmailSent": "Password-Reset-E-Mail gesendet!",
                "changePasswordSuccess": "Passwort erfolgreich ge√§ndert!",
                "disableAccountSuccess": "Konto erfolgreich deaktiviert!",
                "incorrectPassword": "Falsches Passwort.",
                "logoutSuccess": "Erfolgreich abgemeldet!",
                "loginRequired": "Bitte melde dich an, um dein Profil zu speichern.",
                "profileSaveError": "Fehler beim Speichern des Profils.",
                "profileLoadError": "Fehler beim Laden des Profils.",
                "dataLoadError": "Fehler beim Laden der Benutzerdaten.",
                "dataSaveError": "Fehler beim Speichern der Benutzerdaten."
            },
            "en": {
                "brand": "YouthInvests",
                "home": "Home",
                "learn": "Learn",
                "resources": "Resources",
                "simulator": "Simulator",
                "mission": "Our Mission",
                "profile": "Profile",
                "login": "Login",
                "signup": "Sign Up",
                "logout": "Logout",
                "email": "Email:",
                "password": "Password:",
                "currentPassword": "Current Password:",
                "newPassword": "New Password:",
                "confirmPassword": "Confirm Password:",
                "passwordLength": "More than 6 characters",
                "passwordLetter": "At least one letter",
                "passwordNumber": "At least one number",
                "passwordMatch": "Passwords match",
                "forgotPassword": "Forgot Password?",
                "notRegistered": "Not registered yet? <a href=\"#\" onclick=\"switchToSignup()\">Sign Up Now</a>",
                "alreadyRegistered": "Already registered? <a href=\"#\" onclick=\"switchToLogin()\">Back to Login</a>",
                "resetPassword": "Reset Password",
                "changePassword": "Change Password",
                "disableAccount": "Disable Account",
                "disableAccountWarning": "Warning: This action cannot be undone. Your account will be permanently disabled.",
                "loggedIn": "You are logged in.",
                "disclaimerTitle": "Disclaimer",
                "disclaimerP1": "The content of this website, including text, graphics, and simulations, is provided solely for general informational and educational purposes and expressly does not constitute <strong>financial or investment advice</strong> under German law. The operator of this website assumes no liability for financial or other decisions made based on the information provided. No individual recommendations are given.",
                "disclaimerP2": "All information has been created to the best of our knowledge and belief. However, no guarantee is provided for the timeliness, accuracy, completeness, or quality of the provided content. Investments in financial instruments involve significant risks, including the possible total loss of the invested capital. Users are requested to independently and thoroughly inform themselves before making any investment decisions and, if necessary, to seek <strong>qualified, individual financial advice</strong>.",
                "disclaimerP3": "By clicking ‚ÄúAccept,‚Äù you legally agree that you bear sole responsibility for your actions and decisions and release the operator of this website from any liability. You confirm that you have read and understood the disclaimer and our <a href=\"https://www.privacypolicies.com/live/7b3f0632-4bb2-4278-ad12-d1a646c51c79\" target=\"_blank\" style=\"color: #a2e5ff; text-decoration: underline;\">Privacy Policy</a>. If you do not agree with these terms, please discontinue using this website immediately.",
                "copyright": "¬© 2025 YouthInvests. All rights reserved.",
                "privacyPolicy": "Privacy Policy",
                "accept": "Accept",
                "alias": "Alias:",
                "age": "Age:",
                "save": "Save",
                "profileSaved": "Profile successfully saved!",
                "level": "Level: Coming Soon",
                "streak": "Streak: Coming Soon",
                "imageUploadError": "Error uploading profile image.",
                "joinNow": "Join",
                "studentsAt": "students!",
                "enterEmailPassword": "Please enter email and password.",
                "verifyEmail": "Please verify your email first.",
                "enterAllFields": "Please enter email and both passwords.",
                "passwordMismatch": "The passwords do not match!",
                "passwordTooShort": "The password must be more than 6 characters!",
                "passwordNoLetter": "The password needs at least one letter!",
                "passwordNoNumber": "The password needs at least one number!",
                "emailVerificationError": "Error sending verification email: ",
                "enterEmail": "Please enter an email.",
                "resetEmailSent": "Password reset email sent!",
                "changePasswordSuccess": "Password successfully changed!",
                "disableAccountSuccess": "Account successfully disabled!",
                "incorrectPassword": "Incorrect password.",
                "logoutSuccess": "Successfully logged out!",
                "loginRequired": "Please log in to save your profile.",
                "profileSaveError": "Error saving profile.",
                "profileLoadError": "Error loading profile.",
                "dataLoadError": "Error loading user data.",
                "dataSaveError": "Error saving user data."
            },
            "fr": {
                "brand": "JeunesseInvestit",
                "home": "Accueil",
                "learn": "Apprendre",
                "resources": "Ressources",
                "simulator": "Simulateur",
                "mission": "Notre Mission",
                "profile": "Profil",
                "login": "Connexion",
                "signup": "S'inscrire",
                "logout": "D√©connexion",
                "email": "Email :",
                "password": "Mot de passe :",
                "currentPassword": "Mot de passe actuel :",
                "newPassword": "Nouveau mot de passe :",
                "confirmPassword": "Confirmer le mot de passe :",
                "passwordLength": "Plus de 6 caract√®res",
                "passwordLetter": "Au moins une lettre",
                "passwordNumber": "Au moins un chiffre",
                "passwordMatch": "Les mots de passe correspondent",
                "forgotPassword": "Mot de passe oubli√© ?",
                "notRegistered": "Pas encore inscrit ? <a href=\"#\" onclick=\"switchToSignup()\">S'inscrire maintenant</a>",
                "alreadyRegistered": "D√©j√† inscrit ? <a href=\"#\" onclick=\"switchToLogin()\">Retour √† la connexion</a>",
                "resetPassword": "R√©initialiser le mot de passe",
                "changePassword": "Changer le mot de passe",
                "disableAccount": "D√©sactiver le compte",
                "disableAccountWarning": "Attention : Cette action ne peut pas √™tre annul√©e. Votre compte sera d√©finitivement d√©sactiv√©.",
                "loggedIn": "Vous √™tes connect√©.",
                "disclaimerTitle": "Avertissement",
                "disclaimerP1": "Le contenu de ce site web, y compris les textes, graphiques et simulations, est fourni uniquement √† des fins d'information g√©n√©rale et √©ducative et ne constitue express√©ment pas un <strong>conseil financier ou d'investissement</strong> au sens de la loi allemande. L'op√©rateur de ce site web n'assume aucune responsabilit√© pour les d√©cisions financi√®res ou autres prises sur la base des informations fournies. Aucune recommandation individuelle n'est donn√©e.",
                "disclaimerP2": "Toutes les informations ont √©t√© cr√©√©es de bonne foi et selon nos meilleures connaissances. N√©anmoins, aucune garantie n'est fournie quant √† l'actualit√©, l'exactitude, l'exhaustivit√© ou la qualit√© du contenu fourni. Les investissements dans des instruments financiers comportent des risques significatifs, y compris la perte totale possible du capital investi. Les utilisateurs sont pri√©s de s'informer de mani√®re ind√©pendante et approfondie avant de prendre toute d√©cision d'investissement et, si n√©cessaire, de consulter un <strong>conseil financier qualifi√© et individuel</strong>.",
                "disclaimerP3": "En cliquant sur ¬´ Accepter ¬ª, vous acceptez l√©galement d'assumer l'enti√®re responsabilit√© de vos actions et d√©cisions et de d√©gager l'op√©rateur de ce site web de toute responsabilit√©. Vous confirmez avoir lu et compris l'avertissement ainsi que notre <a href=\"https://www.privacypolicies.com/live/7b3f0632-4bb2-4278-ad12-d1a646c51c79\" target=\"_blank\" style=\"color: #a2e5ff; text-decoration: underline;\">Politique de confidentialit√©</a>. Si vous n'√™tes pas d'accord avec ces conditions, veuillez cesser imm√©diatement d'utiliser ce site web.",
                "copyright": "¬© 2025 JeunesseInvestit. Tous droits r√©serv√©s.",
                "privacyPolicy": "Politique de confidentialit√©",
                "accept": "Accepter",
                "alias": "Alias :",
                "age": "√Çge :",
                "save": "Enregistrer",
                "profileSaved": "Profil enregistr√© avec succ√®s !",
                "level": "Niveau : Bient√¥t disponible",
                "streak": "S√©rie : Bient√¥t disponible",
                "imageUploadError": "Erreur lors du t√©l√©chargement de l'image de profil.",
                "joinNow": "Rejoignez maintenant",
                "studentsAt": "√©tudiants !",
                "enterEmailPassword": "Veuillez entrer l'email et le mot de passe.",
                "verifyEmail": "Veuillez d'abord v√©rifier votre email.",
                "enterAllFields": "Veuillez entrer l'email et les deux mots de passe.",
                "passwordMismatch": "Les mots de passe ne correspondent pas !",
                "passwordTooShort": "Le mot de passe doit comporter plus de 6 caract√®res !",
                "passwordNoLetter": "Le mot de passe doit contenir au moins une lettre !",
                "passwordNoNumber": "Le mot de passe doit contenir au moins un chiffre !",
                "emailVerificationError": "Erreur lors de l'envoi de l'email de v√©rification : ",
                "enterEmail": "Veuillez entrer un email.",
                "resetEmailSent": "Email de r√©initialisation du mot de passe envoy√© !",
                "changePasswordSuccess": "Mot de passe chang√© avec succ√®s !",
                "disableAccountSuccess": "Compte d√©sactiv√© avec succ√®s !",
                "incorrectPassword": "Mot de passe incorrect.",
                "logoutSuccess": "D√©connexion r√©ussie !",
                "loginRequired": "Veuillez vous connecter pour enregistrer votre profil.",
                "profileSaveError": "Erreur lors de l'enregistrement du profil.",
                "profileLoadError": "Erreur lors du chargement du profil.",
                "dataLoadError": "Erreur lors du chargement des donn√©es utilisateur.",
                "dataSaveError": "Erreur lors de l'enregistrement des donn√©es utilisateur."
            }
        };
        let budget = 10000;
        let portfolio = {};
        let lastLangChange = 0;
        const debounceDelay = 500;
        function applyTranslations(targetLang) {
            const elements = document.querySelectorAll('[data-translate-key]');
            if (!translations[targetLang]) return;
            elements.forEach(element => {
                const key = element.getAttribute('data-translate-key');
                if (translations[targetLang][key]) {
                    element.innerHTML = translations[targetLang][key];
                }
            });
            updateProfileSection();
            updateLoginModal();
        }
        function changeLanguage(lang) {
            const now = Date.now();
            if (now - lastLangChange < debounceDelay) {
                console.log(`Debouncing LANGUAGE_CHANGE for ${lang}`);
                return;
            }
            lastLangChange = now;
            document.documentElement.lang = lang;
            localStorage.setItem('preferredLanguage', lang);
            applyTranslations(lang);
            const languageSelector = document.getElementById('languageSelector');
            if (languageSelector) {
                languageSelector.value = lang;
            }
            const iframes = [
                { id: 'home-iframe', src: 'home.html' },
                { id: 'lernen-iframe', src: 'lessons.html' },
                { id: 'resourcen-iframe', src: 'ressources.html' },
                { id: 'simulator-iframe', src: 'simulator.html' },
                { id: 'mission-iframe', src: 'ourmission.html' }
            ];
            function sendLanguageMessage() {
                iframes.forEach(iframe => {
                    const iframeElement = document.getElementById(iframe.id);
                    if (iframeElement && iframeElement.contentWindow) {
                        try {
                            iframeElement.contentWindow.postMessage({
                                type: 'LANGUAGE_CHANGE',
                                language: lang,
                                source: 'index'
                            }, '*');
                            console.log(`Sent LANGUAGE_CHANGE to ${iframe.src}: ${lang}`);
                        } catch (error) {
                            console.error(`Error sending message to ${iframe.src}:`, error);
                        }
                    }
                });
            }
            sendLanguageMessage();
        }
        function acceptDisclaimer() {
            const disclaimerModal = document.getElementById('disclaimerModal');
            if (disclaimerModal) {
                disclaimerModal.style.display = 'none';
                document.body.classList.remove('modal-open');
            }
            startCounter();
            const initialButton = document.querySelector('.sidebar a[href="#home"]');
            if (initialButton) showSection('home', initialButton);
        }
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = "flex";
                document.body.classList.add('modal-open');
                if (modalId === 'loginModal') updateLoginModal();
            }
            if (modalId === 'signupModal') {
                const homeIframe = document.getElementById('home-iframe');
                if (homeIframe && homeIframe.contentWindow) {
                    homeIframe.contentWindow.postMessage({ action: 'openSignupModal' }, '*');
                }
            }
        }
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = "none";
                document.body.classList.remove('modal-open');
                if (modalId === 'disclaimerModal') startCounter();
            }
        }
        function switchToSignup() { closeModal('loginModal'); openModal('signupModal'); }
        function switchToLogin() { closeModal('signupModal'); openModal('loginModal'); }
        function updateLoginModal() {
            const user = auth.currentUser;
            const loginForm = document.getElementById('loginForm');
            const logoutForm = document.getElementById('logoutForm');
            const modalTitle = document.getElementById('loginModalTitle');
            const currentLang = document.documentElement.lang || 'de';
            if (user) {
                loginForm.style.display = 'none';
                logoutForm.style.display = 'block';
                modalTitle.setAttribute('data-translate-key', 'account');
                modalTitle.innerHTML = translations[currentLang]['account'] || 'Konto';
            } else {
                loginForm.style.display = 'block';
                logoutForm.style.display = 'none';
                modalTitle.setAttribute('data-translate-key', 'login');
                modalTitle.innerHTML = translations[currentLang]['login'] || 'Anmelden';
            }
            applyTranslations(currentLang);
        }
        function updateProfileSection() {
            const user = auth.currentUser;
            const emailInput = document.getElementById('profile-email');
            const aliasInput = document.getElementById('profile-alias');
            const ageInput = document.getElementById('profile-age');
            const profileImage = document.getElementById('profile-image');
            const logoutButton = document.querySelector('.profile-form button.logout');
            const changePasswordButton = document.querySelector('.profile-form button.change-password');
            const disableAccountButton = document.querySelector('.profile-form button.disable-account');
            const lang = document.documentElement.lang || 'de';
            const isMobile = window.innerWidth <= 768;
            if (user) {
                emailInput.value = user.email || '';
                loadProfileData(user.uid);
                if (isMobile) {
                    logoutButton.style.display = 'block';
                    changePasswordButton.style.display = 'block';
                    disableAccountButton.style.display = 'block';
                } else {
                    logoutButton.style.display = 'none';
                    changePasswordButton.style.display = 'block';
                    disableAccountButton.style.display = 'block';
                }
            } else {
                emailInput.value = '';
                aliasInput.value = '';
                ageInput.value = '';
                profileImage.src = 'profile.png';
                emailInput.placeholder = translations[lang]['emailPlaceholder'] || 'Deine Email';
                aliasInput.placeholder = translations[lang]['aliasPlaceholder'] || 'Dein Alias';
                ageInput.placeholder = translations[lang]['agePlaceholder'] || 'Dein Alter';
                logoutButton.style.display = 'none';
                changePasswordButton.style.display = 'none';
                disableAccountButton.style.display = 'none';
            }
        }
        function validatePassword() {
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-password-confirm').value;
            const lengthCheckIcon = document.getElementById('password-check-length');
            const letterCheckIcon = document.getElementById('password-check-letter');
            const numberCheckIcon = document.getElementById('password-check-number');
            const matchCheckIcon = document.getElementById('password-check-match');
            const hasRequiredLength = password.length > 6;
            const hasLetter = /[a-zA-Z]/.test(password);
            const hasNumber = /[0-9]/.test(password);
            const passwordsMatch = password === confirmPassword && password !== '';
            lengthCheckIcon.classList.toggle('fa-check', hasRequiredLength);
            lengthCheckIcon.classList.toggle('fa-times', !hasRequiredLength);
            lengthCheckIcon.style.color = hasRequiredLength ? 'green' : 'red';
            letterCheckIcon.classList.toggle('fa-check', hasLetter);
            letterCheckIcon.classList.toggle('fa-times', !hasLetter);
            letterCheckIcon.style.color = hasLetter ? 'green' : 'red';
            numberCheckIcon.classList.toggle('fa-check', hasNumber);
            numberCheckIcon.classList.toggle('fa-times', !hasNumber);
            numberCheckIcon.style.color = hasNumber ? 'green' : 'red';
            matchCheckIcon.classList.toggle('fa-check', passwordsMatch);
            matchCheckIcon.classList.toggle('fa-times', !passwordsMatch);
            matchCheckIcon.style.color = passwordsMatch ? 'green' : 'red';
        }
        function validateNewPassword() {
            const password = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('new-password-confirm').value;
            const lengthCheckIcon = document.getElementById('new-password-check-length');
            const letterCheckIcon = document.getElementById('new-password-check-letter');
            const numberCheckIcon = document.getElementById('new-password-check-number');
            const matchCheckIcon = document.getElementById('new-password-check-match');
            const hasRequiredLength = password.length > 6;
            const hasLetter = /[a-zA-Z]/.test(password);
            const hasNumber = /[0-9]/.test(password);
            const passwordsMatch = password === confirmPassword && password !== '';
            lengthCheckIcon.classList.toggle('fa-check', hasRequiredLength);
            lengthCheckIcon.classList.toggle('fa-times', !hasRequiredLength);
            lengthCheckIcon.style.color = hasRequiredLength ? 'green' : 'red';
            letterCheckIcon.classList.toggle('fa-check', hasLetter);
            letterCheckIcon.classList.toggle('fa-times', !hasLetter);
            letterCheckIcon.style.color = hasLetter ? 'green' : 'red';
            numberCheckIcon.classList.toggle('fa-check', hasNumber);
            numberCheckIcon.classList.toggle('fa-times', !hasNumber);
            numberCheckIcon.style.color = hasNumber ? 'green' : 'red';
            matchCheckIcon.classList.toggle('fa-check', passwordsMatch);
            matchCheckIcon.classList.toggle('fa-times', !passwordsMatch);
            matchCheckIcon.style.color = passwordsMatch ? 'green' : 'red';
        }
        function login() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value.trim();
            const lang = document.documentElement.lang || 'de';
            if (!email || !password) return displayErrorMessage(translations[lang]['enterEmailPassword'] || "Bitte Email und Passwort eingeben.");
            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    const user = userCredential.user;
                    if (user.emailVerified) {
                        displaySuccessMessage(translations[lang]['loginSuccess'] || "Erfolgreich angemeldet!");
                        triggerConfetti();
                        closeModal('loginModal');
                    } else {
                        auth.signOut();
                        displayErrorMessage(translations[lang]['verifyEmail'] || "Bitte verifiziere zuerst deine E-Mail.");
                    }
                })
                .catch(error => displayErrorMessage(error.message));
        }
        function signup() {
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value.trim();
            const confirmPassword = document.getElementById('signup-password-confirm').value.trim();
            const lang = document.documentElement.lang || 'de';
            if (!email || !password || !confirmPassword) return displayErrorMessage(translations[lang]['enterAllFields'] || "Bitte Email und beide Passw√∂rter eingeben.");
            if (password !== confirmPassword) return displayErrorMessage(translations[lang]['passwordMismatch'] || "Die Passw√∂rter stimmen nicht √ºberein!");
            if (password.length <= 6) return displayErrorMessage(translations[lang]['passwordTooShort'] || "Das Passwort muss mehr als 6 Zeichen haben!");
            if (!/[a-zA-Z]/.test(password)) return displayErrorMessage(translations[lang]['passwordNoLetter'] || "Das Passwort braucht mindestens einen Buchstaben!");
            if (!/[0-9]/.test(password)) return displayErrorMessage(translations[lang]['passwordNoNumber'] || "Das Passwort braucht mindestens eine Zahl!");
            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    const user = userCredential.user;
                    user.sendEmailVerification()
                        .then(() => {
                            displaySuccessMessage(translations[lang]['signupSuccess'] || "Erfolgreich registriert! Bitte √ºberpr√ºfe deine E-Mail.");
                            triggerConfetti();
                            closeModal('signupModal');
                        })
                        .catch(error => displayErrorMessage(translations[lang]['emailVerificationError'] || "Fehler beim Senden der Verifizierungs-E-Mail: " + error.message));
                })
                .catch(error => displayErrorMessage(error.message));
        }
        function resetPassword() {
            const email = document.getElementById('reset-email').value.trim();
            const lang = document.documentElement.lang || 'de';
            if (!email) return displayErrorMessage(translations[lang]['enterEmail'] || "Bitte Email angeben.");
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    displaySuccessMessage(translations[lang]['resetEmailSent'] || "Password-Reset-E-Mail gesendet!");
                    closeModal('resetModal');
                })
                .catch(error => displayErrorMessage(error.message));
        }
        function changePassword() {
            const user = auth.currentUser;
            const lang = document.documentElement.lang || 'de';
            if (!user) {
                displayErrorMessage(translations[lang]['loginRequired'] || "Bitte melde dich an, um dein Passwort zu √§ndern.");
                return;
            }
            const currentPassword = document.getElementById('current-password').value.trim();
            const newPassword = document.getElementById('new-password').value.trim();
            const confirmPassword = document.getElementById('new-password-confirm').value.trim();
            if (!currentPassword || !newPassword || !confirmPassword) {
                return displayErrorMessage(translations[lang]['enterAllFields'] || "Bitte alle Felder ausf√ºllen.");
            }
            if (newPassword !== confirmPassword) {
                return displayErrorMessage(translations[lang]['passwordMismatch'] || "Die neuen Passw√∂rter stimmen nicht √ºberein!");
            }
            if (newPassword.length <= 6) {
                return displayErrorMessage(translations[lang]['passwordTooShort'] || "Das neue Passwort muss mehr als 6 Zeichen haben!");
            }
            if (!/[a-zA-Z]/.test(newPassword)) {
                return displayErrorMessage(translations[lang]['passwordNoLetter'] || "Das neue Passwort braucht mindestens einen Buchstaben!");
            }
            if (!/[0-9]/.test(newPassword)) {
                return displayErrorMessage(translations[lang]['passwordNoNumber'] || "Das neue Passwort braucht mindestens eine Zahl!");
            }
            const credential = firebase.auth.EmailAuthProvider.credential(user.email, currentPassword);
            user.reauthenticateWithCredential(credential)
                .then(() => {
                    user.updatePassword(newPassword)
                        .then(() => {
                            displaySuccessMessage(translations[lang]['changePasswordSuccess'] || "Passwort erfolgreich ge√§ndert!");
                            closeModal('changePasswordModal');
                        })
                        .catch(error => displayErrorMessage(error.message));
                })
                .catch(error => displayErrorMessage(translations[lang]['incorrectPassword'] || "Falsches Passwort."));
        }
        function disableAccount() {
            const user = auth.currentUser;
            const lang = document.documentElement.lang || 'de';
            if (!user) {
                displayErrorMessage(translations[lang]['loginRequired'] || "Bitte melde dich an, um dein Konto zu deaktivieren.");
                return;
            }
            const password = document.getElementById('disable-password').value.trim();
            if (!password) {
                return displayErrorMessage(translations[lang]['enterEmailPassword'] || "Bitte Passwort eingeben.");
            }
            const credential = firebase.auth.EmailAuthProvider.credential(user.email, password);
            user.reauthenticateWithCredential(credential)
                .then(() => {
                    const userId = user.uid;
                    const userRef = database.ref('users/' + userId);
                    userRef.remove()
                        .then(() => {
                            user.delete()
                                .then(() => {
                                    displaySuccessMessage(translations[lang]['disableAccountSuccess'] || "Konto erfolgreich deaktiviert!");
                                    closeModal('disableAccountModal');
                                    auth.signOut();
                                })
                                .catch(error => displayErrorMessage(error.message));
                        })
                        .catch(error => displayErrorMessage(error.message));
                })
                .catch(error => displayErrorMessage(translations[lang]['incorrectPassword'] || "Falsches Passwort."));
        }
        function logout() {
            const lang = document.documentElement.lang || 'de';
            auth.signOut()
                .then(() => {
                    displaySuccessMessage(translations[lang]['logoutSuccess'] || "Erfolgreich abgemeldet!");
                    closeModal('loginModal');
                })
                .catch(error => displayErrorMessage(error.message));
        }
        function uploadProfileImage() {
            const user = auth.currentUser;
            const lang = document.documentElement.lang || 'de';
            if (!user) {
                displayErrorMessage(translations[lang]['loginRequired'] || "Bitte melde dich an, um ein Profilbild hochzuladen.");
                return;
            }
            const fileInput = document.getElementById('profile-image-upload');
            const file = fileInput.files[0];
            if (!file) return;
            const storageRef = storage.ref(`profile_images/${user.uid}/${file.name}`);
            document.getElementById('loader').style.display = 'block';
            storageRef.put(file)
                .then(snapshot => snapshot.ref.getDownloadURL())
                .then(url => {
                    const userRef = database.ref('users/' + user.uid + '/profile');
                    return userRef.update({ profileImage: url });
                })
                .then(() => {
                    document.getElementById('profile-image').src = url;
                    document.getElementById('loader').style.display = 'none';
                    displaySuccessMessage(translations[lang]['profileSaved'] || "Profilbild erfolgreich hochgeladen!");
                })
                .catch(error => {
                    document.getElementById('loader').style.display = 'none';
                    console.error("Fehler beim Hochladen des Profilbildes:", error);
                    displayErrorMessage(translations[lang]['imageUploadError'] || "Fehler beim Hochladen des Profilbildes.");
                });
        }
        function saveProfile() {
            const user = auth.currentUser;
            const lang = document.documentElement.lang || 'de';
            if (!user) {
                displayErrorMessage(translations[lang]['loginRequired'] || "Bitte melde dich an, um dein Profil zu speichern.");
                return;
            }
            const alias = document.getElementById('profile-alias').value.trim();
            const age = document.getElementById('profile-age').value.trim();
            const userId = user.uid;
            const userRef = database.ref('users/' + userId + '/profile');
            userRef.set({ alias, age }, error => {
                if (error) {
                    console.error("Fehler beim Speichern des Profils:", error);
                    displayErrorMessage(translations[lang]['profileSaveError'] || "Fehler beim Speichern des Profils.");
                } else {
                    displaySuccessMessage(translations[lang]['profileSaved'] || "Profil erfolgreich gespeichert!");
                }
            });
        }
        function loadProfileData(userId) {
            const userRef = database.ref('users/' + userId + '/profile');
            userRef.once('value', snapshot => {
                const data = snapshot.val();
                const aliasInput = document.getElementById('profile-alias');
                const ageInput = document.getElementById('profile-age');
                const profileImage = document.getElementById('profile-image');
                const lang = document.documentElement.lang || 'de';
                if (data) {
                    aliasInput.value = data.alias || '';
                    ageInput.value = data.age || '';
                    profileImage.src = data.profileImage || 'profile.png';
                } else {
                    aliasInput.value = '';
                    ageInput.value = '';
                    profileImage.src = 'profile.png';
                    aliasInput.placeholder = translations[lang]['aliasPlaceholder'] || 'Dein Alias';
                    ageInput.placeholder = translations[lang]['agePlaceholder'] || 'Dein Alter';
                }
            }, error => {
                console.error("Fehler beim Laden des Profils:", error);
                displayErrorMessage(translations[lang]['profileLoadError'] || "Fehler beim Laden des Profils.");
            });
        }
        auth.onAuthStateChanged(user => {
            const loginButton = document.querySelector('.sidebar a.login');
            const signupButton = document.querySelector('.sidebar a.signup');
            const logoutButton = document.querySelector('.sidebar a.logout');
            if (user) {
                loginButton.style.display = 'none';
                signupButton.style.display = 'none';
                logoutButton.style.display = 'flex';
                loadUserData(user.uid);
            } else {
                loginButton.style.display = 'flex';
                signupButton.style.display = 'flex';
                logoutButton.style.display = 'none';
                budget = 10000;
                portfolio = {};
                sendDataToSimulator();
            }
            updateLoginModal();
            updateProfileSection();
        });
        let userRef = null;
        let userRefListener = null;
        function loadUserData(userId) {
            if (userRefListener && userRef) userRef.off('value', userRefListener);
            userRef = database.ref('users/' + userId);
            userRefListener = snapshot => {
                const data = snapshot.val();
                if (data) {
                    budget = typeof data.budget === 'number' ? data.budget : 10000;
                    portfolio = data.portfolio ? data.portfolio : {};
                    portfolio = normalizePortfolioSymbols(portfolio);
                    sendDataToSimulator();
                } else {
                    budget = 10000;
                    portfolio = {};
                    sendDataToSimulator();
                }
            };
            userRef.on('value', userRefListener, error => {
                console.error("Fehler beim Laden der Benutzerdaten:", error);
                displayErrorMessage(translations[document.documentElement.lang || 'de']['dataLoadError'] || "Fehler beim Laden der Benutzerdaten.");
            });
        }
        function normalizePortfolioSymbols(originalPortfolio) {
            const normalizedPortfolio = {};
            for (const symbol in originalPortfolio) {
                const upperSymbol = symbol.toUpperCase();
                if (!normalizedPortfolio[upperSymbol]) {
                    normalizedPortfolio[upperSymbol] = {
                        quantity: originalPortfolio[symbol].quantity,
                        totalInvested: originalPortfolio[symbol].totalInvested
                    };
                } else {
                    normalizedPortfolio[upperSymbol].quantity += originalPortfolio[symbol].quantity;
                    normalizedPortfolio[upperSymbol].totalInvested += originalPortfolio[symbol].totalInvested;
                }
            }
            return normalizedPortfolio;
        }
        function sendDataToSimulator() {
            const iframe = document.getElementById('simulator-iframe');
            if (iframe && iframe.contentWindow) {
                const data = { type: 'AUTH_DATA', budget: budget, portfolio: portfolio };
                iframe.contentWindow.postMessage(data, '*');
            }
        }
        function saveUserData() {
            const user = auth.currentUser;
            const lang = document.documentElement.lang || 'de';
            if (user) {
                const userId = user.uid;
                const userRef = database.ref('users/' + userId);
                userRef.set({ budget: budget, portfolio: portfolio }, error => {
                    if (error) {
                        console.error("Fehler beim Speichern der Daten:", error);
                        displayErrorMessage(translations[lang]['dataSaveError'] || "Fehler beim Speichern der Benutzerdaten.");
                    }
                });
            }
        }
        function showSection(id, element) {
            const user = auth.currentUser;
            const isMobile = window.innerWidth <= 768;
            if (id === 'profil' && !user && isMobile) {
                openModal('loginModal');
                return;
            }
            const sections = document.querySelectorAll('.content section');
            const buttons = document.querySelectorAll('.sidebar a.button, .bottom-nav a.button');
            sections.forEach(section => section.classList.remove('active'));
            buttons.forEach(button => button.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            element.classList.add('active');
            if (id === 'simulator') sendDataToSimulator();
            if (id === 'profil') updateProfileSection();
            const currentLang = document.documentElement.lang || 'de';
            const iframeIds = {
                'lernen': 'lernen-iframe',
                'resourcen': 'resourcen-iframe',
                'simulator': 'simulator-iframe',
                'unsere-mission': 'mission-iframe',
                'home': 'home-iframe'
            };
            if (iframeIds[id]) {
                const iframe = document.getElementById(iframeIds[id]);
                if (iframe && iframe.contentWindow) {
                    iframe.contentWindow.postMessage({
                        type: 'LANGUAGE_CHANGE',
                        language: currentLang,
                        source: 'index'
                    }, '*');
                }
            }
        }
        function displaySuccessMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.innerHTML = `<i class="fas fa-check-circle"></i><span>${message}</span>`;
            document.body.appendChild(messageDiv);
            setTimeout(() => messageDiv.remove(), 4000);
        }
        function displayErrorMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', 'error');
            messageDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i><span>${message}</span>`;
            document.body.appendChild(messageDiv);
            setTimeout(() => messageDiv.remove(), 5000);
        }
        window.onclick = event => {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target == modal) {
                    modal.style.display = "none";
                    document.body.classList.remove('modal-open');
                    if (modal.id === 'disclaimerModal') startCounter();
                }
            });
        };
        window.addEventListener('keydown', event => {
            if (event.key === "Escape") {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (modal.style.display === "flex") {
                        modal.style.display = "none";
                        document.body.classList.remove('modal-open');
                        if (modal.id === 'disclaimerModal') startCounter();
                    }
                });
            }
        });
        window.addEventListener('message', (event) => {
            if (event.data.action === 'openSignupModal') {
                openModal('signupModal');
            } else if (event.data.type === 'LANGUAGE_CHANGE' && event.data.source !== 'index') {
                const targetLang = event.data.language;
                if (translations[targetLang] && targetLang !== document.documentElement.lang) {
                    changeLanguage(targetLang);
                }
            }
        });
    </script>
</body>
</html>